<UserControl x:Class="HospitalManagementSystem.Views.UserControls.CommunicationManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1100">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Title -->
            <RowDefinition Height="*"/>
            <!-- Main Content (Chat + Sidebar) -->
        </Grid.RowDefinitions>

        <!-- ROW 0: Title and Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,15">
            <TextBlock Text="Real-Time Staff Communication Hub"
                       FontSize="26"
                       FontWeight="Bold"
                       Foreground="#005696"/>
            <TextBlock Text="Connect instantly with physicians, labs, and other unit staff."
                       FontSize="14"
                       Foreground="#666666"
                       Margin="0,5,0,0"/>
        </StackPanel>

        <!-- ROW 1: Main Content Grid (Chat & Sidebar) -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <!-- Left: Chat Threads List -->
                <ColumnDefinition Width="10"/>
                <!-- Separator -->
                <ColumnDefinition Width="*"/>
                <!-- Center: Active Chat Window -->
                <ColumnDefinition Width="200"/>
                <!-- Right: Quick Actions/Alerts -->
            </Grid.ColumnDefinitions>

            <!-- COLUMN 0: Chat Threads / Patient List -->
            <Border Grid.Column="0" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Background="White">
                <StackPanel>
                    <TextBlock Text="Active Threads" Padding="10" FontWeight="Bold" Background="#F0F0F0" Foreground="#333"/>
                    <ListBox x:Name="ThreadListBox" MinHeight="600" BorderThickness="0">
                        <!-- Placeholder List Items -->
                        <ListBoxItem Content="Dr. Smith - Patient A101 (Urgent)" Foreground="#DC3545" FontWeight="Bold"/>
                        <ListBoxItem Content="Lab Results - Blood Work P-54"/>
                        <ListBoxItem Content="Nurse Jessica - Unit B (Task Assigned)"/>
                        <ListBoxItem Content="Dr. Chen - Post-Op Follow-up"/>
                        <ListBoxItem Content="Unit Clerk - Scheduling Question"/>
                    </ListBox>
                </StackPanel>
            </Border>

            <!-- Column 1: Separator -->
            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" Width="10"/>

            <!-- COLUMN 2: Active Chat Window -->
            <Grid Grid.Column="2" Margin="10,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Active Thread Header -->
                    <RowDefinition Height="*"/>
                    <!-- Message History -->
                    <RowDefinition Height="Auto"/>
                    <!-- Input Box -->
                </Grid.RowDefinitions>

                <!-- Active Thread Header (FIXED: Wrapped TextBlock in a Border) -->
                <Border Grid.Row="0"
                        BorderBrush="#B3D9FF"
                        BorderThickness="0,0,0,1"
                        Background="#E8F4FF">
                    <TextBlock Text="Active Chat: Dr. Smith - Patient A101"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Padding="10"
                               Foreground="#005696"/>
                </Border>

                <!-- Message History (Placeholder) -->
                <Border Grid.Row="1" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Background="#FFFFFF" Padding="10">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="MessageHistoryStackPanel">
                            <TextBlock Text="[10:05 AM] Nurse (Me): Patient A101 has spiked a fever of 102.4. Orders for Tylenol PRN confirmed?" Margin="0,5,0,5" TextWrapping="Wrap" Background="#E6FFE6" Padding="5" HorizontalAlignment="Right"/>
                            <TextBlock Text="[10:07 AM] Dr. Smith: Yes, proceed with Tylenol now. Also, order stat blood cultures and notify me if fever is still above 101.5 in 1 hour." Margin="0,5,0,5" TextWrapping="Wrap" Background="#F0F8FF" Padding="5" HorizontalAlignment="Left"/>
                            <TextBlock Text="[10:08 AM] Nurse (Me): Done. Ordering cultures now." Margin="0,5,0,5" TextWrapping="Wrap" Background="#E6FFE6" Padding="5" HorizontalAlignment="Right"/>
                            <TextBlock Text="[Message History will be bound here]" FontStyle="Italic" Foreground="#999" Margin="10"/>
                        </StackPanel>
                    </ScrollViewer>
                </Border>

                <!-- Input Box and Send Button -->
                <Grid Grid.Row="2" Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="MessageInputBox"
                             Grid.Column="0"
                             Height="40"
                             FontSize="14"
                             VerticalContentAlignment="Center"
                             Padding="5"
                             Text="Type your message..."/>
                    <!-- FIX: Removed KeyDown="MessageInputBox_KeyDown" -->
                    <Button x:Name="SendMessageButton"
                            Grid.Column="1"
                            Content="Send"
                            Width="80"
                            Height="40"
                            Margin="5,0,0,0"
                            Background="#4CAF50"
                            Foreground="White"
                            FontWeight="Bold"/>
                </Grid>
            </Grid>

            <!-- COLUMN 3: Quick Actions and Alerts -->
            <Border Grid.Column="3" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Background="#FFF5E6" Margin="10,0,0,0" Padding="15">
                <StackPanel>
                    <TextBlock Text="Quick Actions &amp; Alerts" FontSize="16" FontWeight="Bold" Foreground="#FF8C00" Margin="0,0,0,10"/>

                    <Button Content="🚨 CODE BLUE ALERT"
                            Height="45"
                            Margin="0,5"
                            Background="#DC3545"
                            Foreground="White"
                            FontWeight="Bold"/>

                    <Button Content="Page Primary Physician"
                            Height="45"
                            Margin="0,5"
                            Background="#007ACC"
                            Foreground="White"/>

                    <Button Content="STAT Lab Request"
                            Height="45"
                            Margin="0,5"
                            Background="#005696"
                            Foreground="White"/>

                    <TextBlock Text="Patient Monitoring Alerts (Last 10 min):" Margin="0,15,0,5" FontWeight="SemiBold"/>
                    <ListBox ItemsSource="{Binding Alerts}" BorderThickness="0" Background="Transparent" MinHeight="150">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding AlertMessage}" Foreground="#DC3545" TextWrapping="Wrap"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                        <!-- Placeholder Alerts -->
                        <ListBoxItem Content="A101: O2 Saturation below 90%" Foreground="#DC3545"/>
                        <ListBoxItem Content="B204: IV Pump battery low (15%)" Foreground="#FF8C00"/>
                    </ListBox>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
