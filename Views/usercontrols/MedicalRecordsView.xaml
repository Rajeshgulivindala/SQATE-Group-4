<UserControl x:Class="HospitalManagementSystem.Views.UserControls.MedicalRecordsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="1000">

    <!-- Styles -->
    <UserControl.Resources>
        <!-- DataGrid look -->
        <Style x:Key="DataGridStyle" TargetType="{x:Type DataGrid}">
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#EAECEE"/>
            <Setter Property="BorderBrush" Value="#BDC3C7"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RowBackground" Value="White"/>
            <Setter Property="AlternatingRowBackground" Value="#F8F9F9"/>
            <Setter Property="ColumnHeaderStyle">
                <Setter.Value>
                    <Style TargetType="{x:Type DataGridColumnHeader}">
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Background" Value="#ECF0F1"/>
                        <Setter Property="Foreground" Value="#2C3E50"/>
                        <Setter Property="Height" Value="30"/>
                        <Setter Property="Padding" Value="5,0"/>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Toolbar button style (simple, local) -->
        <Style x:Key="{x:Static ToolBar.ButtonStyleKey}" TargetType="{x:Type Button}">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#2980B9"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.85"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3.5*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="2.5*"/>
        </Grid.ColumnDefinitions>

        <!-- Title -->
        <TextBlock Text="📂 Medical Records Management"
                   FontSize="24"
                   FontWeight="SemiBold"
                   Foreground="#34495E"
                   Grid.ColumnSpan="3"
                   Margin="0,0,0,10"/>

        <!-- Records list -->
        <StackPanel Grid.Column="0" Margin="0,50,10,0">
            <TextBlock Text="Recent Patient Visits"
                       FontSize="16"
                       FontWeight="Bold"
                       Margin="0,0,0,5"/>

            <DataGrid x:Name="RecordsDataGrid"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      Height="580"
                      Style="{DynamicResource DataGridStyle}"
                      SelectionMode="Single"
                      SelectionChanged="RecordsDataGrid_SelectionChanged"
                      ItemsSource="{Binding RecordsList}">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding RecordID}" Width="80"/>
                    <DataGridTextColumn Header="Patient ID" Binding="{Binding PatientID}" Width="120"/>
                    <DataGridTextColumn Header="Visit Date"
                                        Binding="{Binding VisitDate, StringFormat='{}{0:yyyy-MM-dd}'}"
                                        Width="*"/>
                    <DataGridTextColumn Header="Chief Complaint" Binding="{Binding ChiefComplaint}" Width="2*"/>
                    <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="*"/>
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>

        <!-- Splitter -->
        <GridSplitter Grid.Column="1"
                      Width="5"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Stretch"
                      Background="#E0E0E0"
                      Margin="5,50,5,0"/>

        <!-- Details / form -->
        <ScrollViewer Grid.Column="2" Margin="10,50,0,0" VerticalScrollBarVisibility="Auto">
            <StackPanel>

                <TextBlock Text="Record Details"
                           FontSize="18"
                           FontWeight="Bold"
                           Foreground="#2C3E50"
                           Margin="0,0,0,15"/>

                <!-- Read-only ID -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBlock Text="Record ID: " FontWeight="SemiBold" Width="100"/>
                    <TextBlock x:Name="RecordIdTextBlock" Text="{Binding RecordID}" Width="200" Foreground="#7F8C8D"/>
                </StackPanel>

                <!-- Patient/Staff IDs (DROPDOWNS) -->
                <TextBlock Text="Patient/Staff IDs" FontWeight="SemiBold" Margin="0,5,0,5"/>
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Patient ID dropdown -->
                    <ComboBox x:Name="cmbPatientId"
                              Grid.Column="0"
                              Margin="0,0,5,0"
                              IsEditable="False"
                              IsTextSearchEnabled="True"
                              ItemsSource="{Binding PatientOptions}"
                              DisplayMemberPath="Display"
                              SelectedValuePath="Id"
                              SelectedValue="{Binding PatientID, Mode=TwoWay}"
                              ToolTip="Select Patient ID"/>

                    <!-- Staff ID dropdown -->
                    <ComboBox x:Name="cmbStaffId"
                              Grid.Column="1"
                              Margin="5,0,0,0"
                              IsEditable="False"
                              IsTextSearchEnabled="True"
                              ItemsSource="{Binding StaffOptions}"
                              DisplayMemberPath="Display"
                              SelectedValuePath="Id"
                              SelectedValue="{Binding StaffID, Mode=TwoWay}"
                              ToolTip="Select Staff/Doctor ID"/>
                </Grid>

                <!-- Dates -->
                <TextBlock Text="Visit and Follow-up Dates" FontWeight="SemiBold" Margin="0,5,0,5"/>
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <DatePicker x:Name="dpVisitDate"
                                Grid.Column="0"
                                SelectedDate="{Binding VisitDate, Mode=TwoWay}"
                                Margin="0,0,5,0"/>

                    <DatePicker x:Name="dpFollowUpDate"
                                Grid.Column="1"
                                SelectedDate="{Binding FollowUpDate, Mode=TwoWay}"
                                ToolTip="Optional Follow-up Date"
                                Margin="5,0,0,0"/>
                </Grid>

                <!-- Vital Signs -->
                <TextBlock Text="Vital Signs" FontWeight="SemiBold" Margin="0,5,0,5"/>
                <TextBox x:Name="txtVitalSigns"
                         Text="{Binding VitalSigns, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         TextWrapping="Wrap"
                         Height="50"
                         VerticalScrollBarVisibility="Auto"
                         Margin="0,0,0,10"/>

                <!-- Chief Complaint -->
                <TextBlock Text="Chief Complaint" FontWeight="SemiBold" Margin="0,5,0,5"/>
                <TextBox x:Name="txtChiefComplaint"
                         Text="{Binding ChiefComplaint, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         TextWrapping="Wrap"
                         Height="70"
                         VerticalScrollBarVisibility="Auto"
                         Margin="0,0,0,10"/>

                <!-- Diagnosis -->
                <TextBlock Text="Diagnosis" FontWeight="SemiBold" Margin="0,5,0,5"/>
                <TextBox x:Name="txtDiagnosis"
                         Text="{Binding Diagnosis, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         TextWrapping="Wrap"
                         Height="70"
                         VerticalScrollBarVisibility="Auto"
                         Margin="0,0,0,10"/>

                <!-- Treatment -->
                <TextBlock Text="Treatment" FontWeight="SemiBold" Margin="0,5,0,5"/>
                <TextBox x:Name="txtTreatment"
                         Text="{Binding Treatment, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         TextWrapping="Wrap"
                         Height="70"
                         VerticalScrollBarVisibility="Auto"
                         Margin="0,0,0,10"/>

                <!-- Prescription -->
                <TextBlock Text="Prescription" FontWeight="SemiBold" Margin="0,5,0,5"/>
                <TextBox x:Name="txtPrescription"
                         Text="{Binding Prescription, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         TextWrapping="Wrap"
                         Height="70"
                         VerticalScrollBarVisibility="Auto"
                         Margin="0,0,0,10"/>

                <!-- Notes -->
                <TextBlock Text="Notes" FontWeight="SemiBold" Margin="0,5,0,5"/>
                <TextBox x:Name="txtNotes"
                         Text="{Binding Notes, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         TextWrapping="Wrap"
                         Height="100"
                         VerticalScrollBarVisibility="Auto"
                         Margin="0,0,0,10"/>

                <!-- Status -->
                <TextBlock Text="Status" FontWeight="SemiBold" Margin="0,5,0,5"/>
                <ComboBox x:Name="StatusComboBox"
                          SelectedValue="{Binding Status, Mode=TwoWay}"
                          Margin="0,0,0,10">
                    <ComboBoxItem Content="Open"/>
                    <ComboBoxItem Content="Pending"/>
                    <ComboBoxItem Content="Closed"/>
                    <ComboBoxItem Content="Cancelled"/>
                </ComboBox>

                <!-- Audit -->
                <GroupBox Header="Audit Information" Margin="0,10,0,10" Padding="10">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="Created: " FontWeight="Normal" Width="70"/>
                            <TextBlock x:Name="CreatedDateTextBlock"
                                       Text="{Binding CreatedDate}"
                                       Foreground="#7F8C8D"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="Updated: " FontWeight="Normal" Width="70"/>
                            <TextBlock x:Name="UpdatedDateTextBlock"
                                       Text="{Binding UpdatedDate}"
                                       Foreground="#7F8C8D"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="By: " FontWeight="Normal" Width="70"/>
                            <TextBlock x:Name="UpdatedByTextBlock"
                                       Text="{Binding UpdatedBy}"
                                       Foreground="#7F8C8D"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <!-- Actions -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
                    <Button Content="➕ New/Clear"
                            x:Name="NewRecordButton"
                            Click="NewRecordButton_Click"
                            Style="{DynamicResource {x:Static ToolBar.ButtonStyleKey}}"
                            Background="#F39C12" Foreground="White"
                            Padding="10,5" Margin="0,0,10,0"/>

                    <Button Content="🗑 Delete Record"
                            x:Name="DeleteRecordButton"
                            Click="DeleteRecordButton_Click"
                            Style="{DynamicResource {x:Static ToolBar.ButtonStyleKey}}"
                            Background="#E74C3C" Foreground="White"
                            Padding="10,5" Margin="0,0,10,0"/>

                    <Button Content="💾 Save Record"
                            x:Name="SaveRecordButton"
                            Click="SaveRecordButton_Click"
                            Style="{DynamicResource {x:Static ToolBar.ButtonStyleKey}}"
                            Background="#2ECC71" Foreground="White"
                            Padding="15,5"/>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>

    </Grid>
</UserControl>
